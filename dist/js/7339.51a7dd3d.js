"use strict";(self["webpackChunkdemo3"]=self["webpackChunkdemo3"]||[]).push([[7339],{57339:function(e,s,l){l.r(s),l.d(s,{default:function(){return ue}});var a=l(66252),t=l(3577),n={key:0,class:"card mb-5 mb-xl-10 shadow-xs",id:"kt_profile_details_view"},o={class:"card-header cursor-pointer"},r={class:"card-title m-0"},c={class:"fw-bold m-0"},d={class:"card-body p-9"},i={class:"row mb-7"},f=(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"},"分享者",-1),_={class:"col-lg-8"},g={class:"fw-bold fs-6"},u={class:"row mb-7"},w=(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"},"分享信息",-1),b={class:"col-lg-8"},v={class:"fw-bold fs-6"},m={class:"row mb-7"},h=(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"}," 文件签名 ",-1),p={class:"col-lg-8 d-flex align-items-center"},k={class:"fw-bold fs-6 me-2"},x={key:0},y={key:0,class:"badge badge-warning"},I={key:1},E={key:0,class:"badge badge-success"},D={key:1,class:"badge badge-danger"},S={class:"row mb-7"},z=(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"},"分享时间",-1),U={class:"col-lg-8 fv-row"},q={class:"fw-bold fs-6"},M={class:"row mb-7"},A=(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"},"过期时间",-1),C={class:"col-lg-8"},L={href:"#",class:"fw-bold fs-6 text-dark text-hover-primary"},H={class:"row mb-7"},R=(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"}," 可下载次数 ",-1),j={class:"col-lg-8"},B={class:"fw-bold fs-6 text-dark"},F=(0,a._)("div",{class:"row mb-7"},[(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"},"剩余下载次数"),(0,a._)("div",{class:"col-lg-8"},[(0,a._)("span",{class:"fw-bold fs-6 text-dark"},"5")])],-1),J={class:"row mb-10"},K=(0,a._)("label",{class:"col-lg-4 fw-semobold text-muted"},"明文分享",-1),O={class:"col-lg-8"},T={class:"fw-bold fs-6"},G={key:0,class:"notice d-flex bg-light-warning rounded border-warning border border-dashed p-6"},W={class:"svg-icon svg-icon-2tx svg-icon-warning me-4"},Y=(0,a._)("div",{class:"d-flex flex-stack flex-grow-1"},[(0,a._)("div",{class:"fw-semobold"},[(0,a._)("h4",{class:"text-gray-800 fw-bold"},"您无法下载原文件！"),(0,a._)("div",{class:"fs-6 text-gray-600"},[(0,a.Uk)(" 分享者未设置明文分享，因此您仅能下载加密后的文件和文件签名。"),(0,a._)("br"),(0,a.Uk)("加密后的文件无法直接查看，需要使用加密密钥解密后才可查看。 ")])])],-1),Z={key:1,class:"notice d-flex bg-light-success rounded border-success border border-dashed p-6"},P={class:"svg-icon svg-icon-2tx svg-icon-success me-4"},N=(0,a._)("div",{class:"d-flex flex-stack flex-grow-1"},[(0,a._)("div",{class:"fw-semobold"},[(0,a._)("h4",{class:"text-gray-800 fw-bold"},"您可以下载原文件！"),(0,a._)("div",{class:"fs-6 text-gray-600"}," 分享者设定了明文分享，点击下载后将自动进行解密。 ")])],-1),Q={key:1,class:"d-flex flex-column flex-column-fluid"},V={class:"d-flex flex-column flex-column-fluid text-center p-10 py-lg-15"},X={class:"pt-lg-10 mb-10"},$=(0,a._)("h1",{class:"fw-bold fs-4x text-gray-800 mb-10"},"出错啦",-1),ee={class:"fw-semobold fs-3 text-muted mb-15"};function se(e,s,l,se,le,ae){var te=(0,a.up)("inline-svg");return(0,a.wg)(),(0,a.iD)(a.HY,null,[0===e.errMsg.length?((0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",o,[(0,a._)("div",r,[(0,a._)("h3",c,(0,t.zw)(e.fileInfo.share_filename),1)]),(0,a._)("a",{class:"btn btn-primary align-self-center",onClick:s[0]||(s[0]=function(){for(var s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];return e.download_click&&e.download_click.apply(e,s)})},"下载")]),(0,a._)("div",d,[(0,a._)("div",i,[f,(0,a._)("div",_,[(0,a._)("span",g,(0,t.zw)(e.fileInfo.share_user),1)])]),(0,a._)("div",u,[w,(0,a._)("div",b,[(0,a._)("span",v,(0,t.zw)(e.fileInfo.description),1)])]),(0,a._)("div",m,[h,(0,a._)("div",p,[(0,a._)("span",k,(0,t.zw)(!0===e.fileInfo.share_rsa_pk?"已签名":"未签名"),1),e.fileInfo.share_rsa_pk?((0,a.wg)(),(0,a.iD)("div",x,[e.downloaded_content.content?((0,a.wg)(),(0,a.iD)("div",I,[e.rsa_signed?((0,a.wg)(),(0,a.iD)("span",E," 验证成功 ")):(0,a.kq)("",!0),e.rsa_signed?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("span",D," 验证失败 "))])):((0,a.wg)(),(0,a.iD)("span",y," 下载后验证 "))])):(0,a.kq)("",!0)])]),(0,a._)("div",S,[z,(0,a._)("div",U,[(0,a._)("span",q,(0,t.zw)(new Date(e.fileInfo.created_timestamp).toLocaleString()),1)])]),(0,a._)("div",M,[A,(0,a._)("div",C,[(0,a._)("a",L,(0,t.zw)(new Date(e.fileInfo.created_timestamp+864e5*e.fileInfo.expired_days).toLocaleString()),1)])]),(0,a._)("div",H,[R,(0,a._)("div",j,[(0,a._)("span",B,(0,t.zw)(e.fileInfo.expired_download_count),1)])]),F,(0,a._)("div",J,[K,(0,a._)("div",O,[(0,a._)("span",T,(0,t.zw)(!0===e.fileInfo.share_enc_key?"是":"否"),1)])]),e.fileInfo.share_enc_key?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",G,[(0,a._)("span",W,[(0,a.Wm)(te,{src:"media/icons/duotune/general/gen044.svg"})]),Y])),e.fileInfo.share_enc_key?((0,a.wg)(),(0,a.iD)("div",Z,[(0,a._)("span",P,[(0,a.Wm)(te,{src:"media/icons/duotune/general/gen043.svg"})]),N])):(0,a.kq)("",!0)])])):(0,a.kq)("",!0),0!==e.errMsg.length?((0,a.wg)(),(0,a.iD)("div",Q,[(0,a._)("div",V,[(0,a._)("div",X,[$,(0,a._)("div",ee,(0,t.zw)(e.errMsg),1)])])])):(0,a.kq)("",!0)],64)}var le=l(70655),ae=l(2262),te=l(33907),ne=l(78764),oe=l.n(ne),re=l(22201),ce=l(81354),de=l.n(ce),ie=l(31166),fe=(0,a.aZ)({name:"shared-file",components:{},setup:function(){var e=this,s=(0,te.oR)(),l=(0,re.yj)(),t=(0,a.Fl)((function(){return s.state.ShareFileModule.shared_file_info})),n=(0,ae.iH)(""),o=(0,a.Fl)((function(){return s.state.AuthModule.downloaded_content})),r=(0,ae.iH)(!1);(0,a.bv)((function(){return(0,le.mG)(e,void 0,void 0,(function(){var e,a;return(0,le.Jh)(this,(function(o){switch(o.label){case 0:return[4,s.dispatch("get_shared_file_info",l.query)];case 1:return o.sent(),e=Object.keys(s.getters.getErrors)[0],a=s.getters.getErrors[e],a?(n.value=a[0],[2]):t.value.share_filename?(console.log(t.value),[2]):(n.value="您的分享链接已经被篡改，请检查是否复制了完整链接。",[2])}}))}))}));var c=function(){return(0,le.mG)(e,void 0,void 0,(function(){var e,l,a,n,c,d,i,f,_;return(0,le.Jh)(this,(function(g){switch(g.label){case 0:return[4,s.dispatch("download_share_file",{id:t.value.share_file_id})];case 1:return g.sent(),e=Object.keys(s.getters.getErrors)[0],l=s.getters.getErrors[e],l?(oe().fire({text:l[0],icon:"error",buttonsStyling:!1,confirmButtonText:"确认",customClass:{confirmButton:"btn fw-semobold btn-light-danger"}}),[2]):(a=o.value.content,t.value.share_rsa_pk&&(n=new ie.KJUR.crypto.Signature({alg:"SHA1withRSA"}),n.init(ie.KEYUTIL.getKey(t.value.rsa_public_key)),n.updateString(a),r.value=n.verify(ie.b64tohex(t.value.signature))),t.value.share_enc_key&&(c=de().AES.decrypt(a,de().enc.Utf8.parse(t.value.enc_key),{mode:de().mode.ECB,padding:de().pad.Pkcs7}),a=c.toString(de().enc.Utf8)),d=function(e){for(var s=e.split(":")[1],l=window.atob(e),a=l.length,t=new Uint8Array(a),n=0;n<a;++n)t[n]=l.charCodeAt(n);return new Blob([t],{type:s})},i=document.createElement("a"),f=d(a),_=document.createEvent("HTMLEvents"),_.initEvent("click",!0,!0),i.download=t.value.share_filename,i.href=URL.createObjectURL(f),i.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),[2])}}))}))};return{store:s,route:l,fileInfo:t,errMsg:n,download_click:c,downloaded_content:o,rsa_signed:r}}}),_e=l(83744);const ge=(0,_e.Z)(fe,[["render",se]]);var ue=ge}}]);